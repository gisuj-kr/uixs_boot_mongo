<template>
	<!-- í…œí”Œë¦¿ì— ì¶”ê°€ -->
	<div v-if="processingProgress > 0 && processingProgress < 100" class="progress-container">
		<div class="progress-text">íŒŒì¼ ì •ë³´ ìˆ˜ì§‘ ì¤‘... {{ processingProgress }}%</div>
		<div class="progress-bar">
			<div class="progress-fill" :style="{width: processingProgress + '%'}"></div>
		</div>
	</div>
	<!--container-->
	<div class="container no-max-value">
		
		<div class="content">
			<div class="content_inner">
				<div class="html-list-util-gnb-area" v-if="ia_tabs.length > 1">
					<a 
						href="#none"
							v-for="(tab, index) in ia_tabs" 
							:class="{selected : tabIndex == index}" 
							@click.prevent="siteMapChange(index)">{{tab.tab_name}}</a>
				</div>
				<div class="search-wrap">
					<div class="input_section">
						<ul class="input_wrap">
							<li class="input_area search_case">
								<label for="search-string">ê²€ìƒ‰</label>
								<input type="text" placeholder="í™”ë©´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" v-model="searchText" @keyup.enter="searchHandler" :style="isMobile && 'width: 82%'">
								<button type="button" class="btn_search" @click.prevent="searchHandler"></button>
							</li>
							<li style="margin-top: 10px;">
                                <dl class="horizontal-dl">
                                    <dt>ìµœì¢…ìˆ˜ì •ì¼:</dt>
                                    <dd class="button-group">
										<!-- ì£¼ ë‹¨ìœ„ í•„í„°ë§ ë²„íŠ¼ë“¤ -->
										<button type="button" class="round-button" @click="filterByLastWeek(1)">1ì£¼ì¼</button>
										<button type="button" class="round-button" @click="filterByLastWeek(2)">2ì£¼ì¼</button>
										<button type="button" class="round-button" @click="filterByLastWeek(3)">3ì£¼ì¼</button>

                                        <button type="button" class="round-button" @click="filterByDate(1)">1ê°œì›”</button>
                                        <button type="button" class="round-button" @click="filterByDate(2)">2ê°œì›”</button>
                                        <button type="button" class="round-button" @click="filterByDate(3)">3ê°œì›”</button>
                                        <button type="button" class="round-button" @click="sortByDate">ìµœì‹ ìˆœ</button>
                                        <button type="button" class="round-button" @click="resetData">ì´ˆê¸°í™”</button>
                                    </dd>
                                </dl>
                            </li>
						</ul>
					</div>
				</div>
				<div class="tit_area" >
					<h2 v-if="pageChannel != 'SH_PA'">í™”ë©´ëª©ë¡</h2>
					<div v-if="pageChannel === 'SH_PA'" class="list-version">
						<select name="" id=""  v-model="listVersion" @change="changeListVersion">
							<option value="asis">í™”ë©´ëª©ë¡ [AS-IS]</option>
							<option value="tobe">í™”ë©´ëª©ë¡ [TO-BE]</option>
						</select>
					</div>
					<span class="tit_btn_area" v-if="!isMobile">
						<a :href="iaDownloadUrl" target="_blank" class="btn_mid_type01">ë©”ë‰´ ë‹¤ìš´ë¡œë“œ(excel)</a>
					</span>
				</div>
				
				<ul class="view_list_wrap bor_top">
					<li>
						<ul class="pb_w_tab">
							<li v-for="(header, hdIdx) in EXCEL_JSON_HEADER">
								<a :href="'#'+header">{{header}}</a>
							</li>
						</ul>
						
						<div class="grey_list_type white" style="padding: 0" >
							<div class="con_area">
								<!-- html loop ì‹œì‘ -->
								<template v-for="(data, index) in searched_data" :key="index">
								<div class="menu_wrap" 
									v-if="data.length > 0"
									:data-group-index="index"
									ref="groupObserverTargets"
								>
									<div class="menu_tit on">
										<div class="row-color-info" v-if="listVersion == 'tobe'">
											<div><span class="row-color-info__renewal-1st"></span>1ì°¨ë¦¬ë‰´ì–¼</div>
											<div><span class="row-color-info__renewal-2st"></span>2ì°¨ë¦¬ë‰´ì–¼</div>
											<div><span class="row-color-info__renewal-1st--modify"></span>1ì°¨ê°œì„ </div>
											<div><span class="row-color-info__self--modify"></span>ê°œì„ ì‘ì—…</div>
											<div><span class="row-color-info__as-is--modify"></span>as-is_ê°œì„ </div>
										</div>
										<button 
											type="button"
											:id="EXCEL_JSON_HEADER[index]" 
											aria-expanded="true"
											:aria-controls="'view-list-table'+index"
											@click="accordion($event, index)">{{EXCEL_JSON_HEADER[index]}}<span class="group-item-count">({{data.length}}ê°œ)</span></button>
									</div>

									<div v-if="isGroupVisible(index)">
										<div v-if="listVersion == 'tobe'">
											<html-list-linew-component
												:key="index"
												:is-mobile="isMobile"
												:item="data"
												:idx="index"
												:excel-json-header="EXCEL_JSON_HEADER"
												:doc-base="selectedChannel.doc_base"
												@open-html="openHtml"
												:ref="el => setRefs(el, index)"
											>
											</html-list-linew-component>
										</div>
										<div v-else-if="listVersion == 'asis' && storageChannel == 'SH_PA'"> 
											<html-list-component
												:key="index"
												:is-mobile="isMobile"
												:item="data"
												:idx="index"
												:excel-json-header="EXCEL_JSON_HEADER"
												:doc-base="selectedChannel.doc_base"
												@open-html="openHtml"
												:ref="el => setRefs(el, index)"
											>
											</html-list-component>
										</div>
									</div>

									<!-- ì•„ì§ ë¡œë”©ë˜ì§€ ì•Šì€ ê·¸ë£¹ì„ ìœ„í•œ í”Œë ˆì´ìŠ¤í™€ë” -->
									<div v-else class="lazy-placeholder">
										<div class="placeholder-content">
											<div class="placeholder-text">
												ìŠ¤í¬ë¡¤í•˜ë©´ {{data.length}}ê°œ í•­ëª©ì´ ë¡œë“œë©ë‹ˆë‹¤...
											</div>
											<div class="placeholder-loader">
												<div class="loader-dots">
													<span></span>
													<span></span>
													<span></span>
												</div>
											</div>
										</div>
									</div>

								</div>
								</template>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<!--// container-->
	
	<!-- ëª¨ë°”ì¼ html ë¯¸ë¦¬ë³´ê¸° -->
	<div class="modal_layer_pop" v-show="htmlShow" @click="closeHtmlFromDim">
		<div class="mobile_view" style="position:absolute">
			<ul class="box_type_check" style="position: absolute; top: -58px; left: 5px;">
				<li>
					<input type="radio" id="resize-viewer1" name="resize-viewer" value="375" class="resize-viewer" checked>
					<label for="resize-viewer1">375px</label>
				</li>
				<li >
					<input type="radio" id="resize-viewer2" name="resize-viewer"   value="360" class="resize-viewer">
					<label for="resize-viewer2">360px</label>
				</li>
				<li>
					<input type="radio" id="resize-viewer3" name="resize-viewer" value="320" class="resize-viewer">
					<label for="resize-viewer3">320px</label>
				</li>
				<li>
					<input type="text" readonly id="resize-viewer-custom" name="resize-viewer" value="375px" class="resize-viewer" style="font-size: 12px; border: 1px solid #ccc">
				</li>
			</ul>
			<iframe src="about:blank" frameborder="0" id="html-view-area" style="width: 100%; height: 100%; display: none; overflow: hidden;"></iframe>
		</div>
	</div>
	
	<div class="ia-go-top"><button type="button" @click="goTop">top</button></div>

</template>


<script>
const HtmlListComponent = defineAsyncComponent(
	() => loadModule('/static/js/vue/HtmlListComponent.vue', vue3LoadOption)
);
const HtmlListRenewComponent = defineAsyncComponent(
	() => loadModule('/static/js/vue/HtmlListRenewComponent.vue', vue3LoadOption)
);
// SH_PA
export default {
	mixins: [channelMixin],
	components: {
		'html-list-component': HtmlListComponent,
		'html-list-linew-component': HtmlListRenewComponent
	},
	data: {
		list: [],
		iaList: [], // ia list
		searchList: [],
		searchText: '',
		htmlShow: false, // html í´ë¦­í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸° ì—¬ë¶€
		resizing: false, // html ë¯¸ë¦¬ë³´ê¸° íŒì—…ì°½ ë¦¬ì‚¬ì´ì§• ì—¬ë¶€
		perList: [], // ê°œì´ë±…í‚¹
		bizList: [], // ê¸°ì—…ë±…í‚¹
		pdtList: [], // ê¸ˆìœµìƒí’ˆëª° ë¦¬ìŠ¤íŠ¸
		autList: [], // ì¸ì¦ì„¼í„°
		serviceList: [], // ì„œë¹„ìŠ¤
		tabGubun: 'ê°œì¸ë±…í‚¹', // ê°œì¸ë±…í‚¹ ì„ íƒì¸ê²½ìš°
		tabChannel: false,
		EXCEL_JSON_HEADER: [],
		EXCEL_JSON_DATA: [],
		searched_data: [],
		domain: 'http://13.125.6.144:7001',
		iaDownloadUrl: '',
		tabIndex: 0,
		ia_tabs: [],
		urlCache: new Map(),
		ORIGINAL_EXCEL_JSON_HEADER: null,
		worker: null, // WebWorker ì¸ìŠ¤í„´ìŠ¤
		processingProgress: 0, // ì§„í–‰ë¥ 
		storageChannel: localStorage.getItem('channel'),
		listVersion: 'tobe',
		refsArray: [],
		compoVisible: false,  // data-box ê°€ì‹œì„± ìƒíƒœ
      	observer: null,
		// ì§€ì—° ë¡œë”© ê´€ë ¨ ì†ì„±
		lazyLoading: {
			visibleGroups: new Set(),        // í˜„ì¬ ë³´ì´ëŠ” ê·¸ë£¹ë“¤ì˜ ì¸ë±ìŠ¤
			observer: null,                  // Intersection Observer ì¸ìŠ¤í„´ìŠ¤
			rootMargin: '200px',             // ë¯¸ë¦¬ ë¡œë”©í•  ì—¬ë°± (200px ë¯¸ë¦¬ ì¤€ë¹„)
			threshold: 0.1                   // 10% ë³´ì´ë©´ íŠ¸ë¦¬ê±°
		},
		// Ctrl+F ê´€ë ¨
		browserSearchActive: false,
		allGroupsForceLoaded: false
	},
	computed: {
		docRoot: function () {
			var channel = this.getChannelCode;
			var url = '';
			
			return url;
		},
		htmlChannel: function () {
			const channelStore = useChannelStore();

			return channelStore.selectedHeaderChannel;
		},
		pageChannel() {
			return this.storageChannel;
		},
		// ëª¨ë“  ê·¸ë£¹ì´ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
		isAllGroupsLoaded() {
			const totalGroups = this.getTotalVisibleGroups();
			return this.lazyLoading.visibleGroups.size >= totalGroups;
		}
	},
	watch: {
		htmlChannel: {
			handler: function (nVal, oVal) {
				if (nVal !== 'all' && nVal !== oVal) {
					this.storageChannel = nVal;
					// ì—‘ì…€[html list] ë¡œë“œ
					this.loadExcelWithLastModified();
				}
			},
			deep: false
		},
		searched_data: {
			handler() {
				// ë°ì´í„°ê°€ ë³€ê²½ë˜ë©´ ì§€ì—° ë¡œë”© ì¬ì„¤ì •
				this.$nextTick(() => {
					this.resetLazyLoading();
				});
			},
			deep: false
		}
	},
	mounted: async function () {
		// ì—‘ì…€[html list] ë¡œë“œ
		await this.loadExcelWithLastModified();

		// ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ Observer ì´ˆê¸°í™”
    	//this.initDataBoxObserver();
		// ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ resize
	
		$('.mobile_view').resizable({
			minWidth: 320,
			minHeight: 640,
			handles: 'w,e',
			start: (event, ui) => {
				$('#html-view-area').css('pointer-events', 'none');
				
				this.resizing = true; // html ë¯¸ë¦¬ë³´ê¸° íŒì—…ì°½ ë¦¬ì‚¬ì´ì§• ì—¬ë¶€
			},
			stop: function (event, ui) {
				$('#html-view-area').css('pointer-events', 'auto');
				$('#resize-viewer-custom').val(ui.size.width + 'px');
				
				ui.element[0].style.left = 'auto';
				
				setTimeout(() => {
					this.resizing = false; // html ë¯¸ë¦¬ë³´ê¸° íŒì—…ì°½ ë¦¬ì‚¬ì´ì§• ì—¬ë¶€
				})
			}
		});
	
		
		// ë¯¸ë¦¬ë³´ê¸° í™”ë©´ ë¦¬ì‚¬ì´ì¦ˆ
		$('.resize-viewer').on('change', function () {
			var size = $(this).val();

			$('.mobile_view').width(size);
			
			$('#resize-viewer-custom').val(size+'px');
		})
		.on('focus', function () {
			$('.box_type_check').find('input:radio').each(function () {
				$(this).prop('checked', false);
			})
		});
		
	 	// ë¯¸ë¦¬ë³´ê¸°ì˜ì—­ ì‚¬ì´ì¦ˆ ì»¤ìŠ¤í…€ input ì—ì„œ ì—”í„° ì¹œ ê²½ìš° ë¯¸ë¦¬ë³´ê¸°ì°½ ì‚¬ì´ì¦ˆ ì¡°ì ˆ
		$('#resize-viewer-custom').on('keyup', function () {
			var size = parseInt($(this).val());
			
			$('.mobile_view').width(size);
		});

		// Ctrl+F ê°ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
		document.addEventListener('keydown', this.handleKeyboardSearch);
		
		// F3 (ë‹¤ìŒ ì°¾ê¸°) ê°ì§€
		document.addEventListener('keydown', (event) => {
			if (event.key === 'F3') {
				this.ensureAllGroupsLoaded();
			}
		});
	},
	methods: {
		// ì§€ì—°ë¡œë”© ë©”ì„œë“œ
		// ìŠ¤í¬ë¡¤ì„ íŠ¹ì • ê·¸ë£¹ìœ¼ë¡œ ì´ë™í•˜ë©´ì„œ í•´ë‹¹ ê·¸ë£¹ ë¡œë“œ
		scrollToGroupAndLoad(groupIndex) {
			// ë¨¼ì € ê·¸ë£¹ì„ ë¡œë“œ
			this.forceLoadGroup(groupIndex);
			
			// DOM ì—…ë°ì´íŠ¸ í›„ ìŠ¤í¬ë¡¤
			this.$nextTick(() => {
				const targetElement = document.getElementById(this.EXCEL_JSON_HEADER[groupIndex]);
				if (targetElement) {
					targetElement.scrollIntoView({ 
						behavior: 'smooth', 
						block: 'start' 
					});
				}
			});
		},

		// ê²€ìƒ‰ ê²°ê³¼ í•˜ì´ë¼ì´íŠ¸ì™€ í•¨ê»˜ í•´ë‹¹ ê·¸ë£¹ìœ¼ë¡œ ì´ë™
		highlightSearchResultAndScroll() {
			if (this.searchText.trim() === '') return;
			
			// ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆëŠ” ì²« ë²ˆì§¸ ê·¸ë£¹ ì°¾ê¸°
			for (let i = 0; i < this.searched_data.length; i++) {
				if (this.searched_data[i].length > 0) {
					this.scrollToGroupAndLoad(i);
					break;
				}
			}
		},
		
		// ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™” - ë³´ì´ì§€ ì•ŠëŠ” ê·¸ë£¹ ì–¸ë¡œë“œ
		optimizeMemoryUsage() {
			const viewportHeight = window.innerHeight;
			const scrollY = window.scrollY;
			
			// í˜„ì¬ í™”ë©´ì—ì„œ ë„ˆë¬´ ë©€ë¦¬ ë–¨ì–´ì§„ ê·¸ë£¹ë“¤ ì–¸ë¡œë“œ
			this.lazyLoading.visibleGroups.forEach(groupIndex => {
				const element = document.querySelector(`[data-group-index="${groupIndex}"]`);
				if (element) {
					const rect = element.getBoundingClientRect();
					const distanceFromViewport = Math.abs(rect.top - viewportHeight / 2);
					
					// í™”ë©´ì—ì„œ 2ë°° ì´ìƒ ë©€ì–´ì§„ ê·¸ë£¹ì€ ì–¸ë¡œë“œ (ë©”ëª¨ë¦¬ ì ˆì•½)
					if (distanceFromViewport > viewportHeight * 2) {
						this.lazyLoading.visibleGroups.delete(groupIndex);
						console.log(`ê·¸ë£¹ ${groupIndex} ë©”ëª¨ë¦¬ì—ì„œ ì–¸ë¡œë“œë¨`);
					}
				}
			});
		},
		
		// ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
		getPerformanceStats() {
			const stats = this.getLazyLoadingStats();
			const totalRows = this.searched_data.reduce((sum, group) => sum + group.length, 0);
			const loadedRows = Array.from(this.lazyLoading.visibleGroups)
				.reduce((sum, index) => sum + (this.searched_data[index]?.length || 0), 0);
			
			return {
				groups: stats,
				rows: {
					total: totalRows,
					loaded: loadedRows,
					percentage: totalRows > 0 ? Math.round((loadedRows / totalRows) * 100) : 0
				},
				memoryOptimized: true
			};
		},
		
		// ê°œë°œì ë„êµ¬ìš© - ëª¨ë“  í†µê³„ ì¶œë ¥
		// console ì°½ì— $vm0.debugLazyLoading() ì‹¤í–‰
		debugLazyLoading() {
			const perfStats = this.getPerformanceStats();
			console.group('ğŸš€ ì§€ì—° ë¡œë”© ìƒíƒœ');
			console.log('ğŸ“Š ê·¸ë£¹ í†µê³„:', perfStats.groups);
			console.log('ğŸ“‹ í–‰ í†µê³„:', perfStats.rows);
			console.log('ğŸ¯ ë³´ì´ëŠ” ê·¸ë£¹:', Array.from(this.lazyLoading.visibleGroups).sort());
			console.log('ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰:', `${perfStats.rows.percentage}% ë¡œë“œë¨`);
			console.groupEnd();
			
			return perfStats;
		},
		// íŠ¹ì • ê·¸ë£¹ì´ ë³´ì´ëŠ”ì§€ í™•ì¸
		isGroupVisible(index) {
			return this.lazyLoading.visibleGroups.has(index);
		},
		
		// Intersection Observer ì´ˆê¸°í™”
		initLazyLoading() {
			// ê¸°ì¡´ Observerê°€ ìˆë‹¤ë©´ ì •ë¦¬
			this.destroyLazyLoading();
			
			// Observer ì½œë°± í•¨ìˆ˜
			const callback = (entries) => {
				entries.forEach(entry => {
					const groupIndex = parseInt(entry.target.dataset.groupIndex);
					
					if (entry.isIntersecting) {
						// ê·¸ë£¹ì´ ë³´ì´ê²Œ ë˜ë©´ visibleGroupsì— ì¶”ê°€
						this.lazyLoading.visibleGroups.add(groupIndex);
						console.log(`ê·¸ë£¹ ${groupIndex} (${this.EXCEL_JSON_HEADER[groupIndex]}) ë¡œë“œë¨`);
					} else {
						// ê·¸ë£¹ì´ í™”ë©´ì—ì„œ ë©€ì–´ì§€ë©´ ì œê±° (ë©”ëª¨ë¦¬ ì ˆì•½)
						// ë‹¨, ë„ˆë¬´ ìì£¼ ì œê±°í•˜ë©´ ê¹œë¹¡ì„ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš©
						// this.lazyLoading.visibleGroups.delete(groupIndex);
					}
				});
			};
			
			// Observer ì˜µì…˜
			const options = {
				root: null,
				rootMargin: this.lazyLoading.rootMargin,
				threshold: this.lazyLoading.threshold
			};
			
			// Observer ìƒì„±
			this.lazyLoading.observer = new IntersectionObserver(callback, options);
			
			// ê´€ì°° ì‹œì‘
			this.observeGroups();
		},
		
		// ê·¸ë£¹ë“¤ ê´€ì°° ì‹œì‘
		observeGroups() {
			this.$nextTick(() => {
				const targets = this.$refs.groupObserverTargets;
				if (!targets) return;
				
				// refê°€ ë°°ì—´ì¸ ê²½ìš°ì™€ ë‹¨ì¼ ìš”ì†Œì¸ ê²½ìš° ì²˜ë¦¬
				const elements = Array.isArray(targets) ? targets : [targets];
				
				elements.forEach(element => {
					if (element && this.lazyLoading.observer) {
						this.lazyLoading.observer.observe(element);
					}
				});
				
				console.log(`${elements.length}ê°œ ê·¸ë£¹ ê´€ì°° ì‹œì‘`);
			});
		},
		
		// ì§€ì—° ë¡œë”© ì •ë¦¬
		destroyLazyLoading() {
			if (this.lazyLoading.observer) {
				this.lazyLoading.observer.disconnect();
				this.lazyLoading.observer = null;
			}
			this.lazyLoading.visibleGroups.clear();
		},
		
		// ë°ì´í„° ë³€ê²½ ì‹œ ì§€ì—° ë¡œë”© ì¬ì´ˆê¸°í™”
		resetLazyLoading() {
			this.destroyLazyLoading();
			
			// ì•½ê°„ì˜ ì§€ì—° í›„ ì¬ì´ˆê¸°í™” (DOM ì—…ë°ì´íŠ¸ ëŒ€ê¸°)
			this.$nextTick(() => {
				setTimeout(() => {
					this.initLazyLoading();
				}, 100);
			});
		},
		
		// ì²« ë²ˆì§¸ ê·¸ë£¹ë“¤ ë¯¸ë¦¬ ë¡œë“œ (ì´ˆê¸° í™”ë©´)
		preloadInitialGroups(count = 3) {
			for (let i = 0; i < Math.min(count, this.searched_data.length); i++) {
				if (this.searched_data[i].length > 0) {
					this.lazyLoading.visibleGroups.add(i);
				}
			}
		},
		
		// íŠ¹ì • ê·¸ë£¹ ê°•ì œ ë¡œë“œ
		forceLoadGroup(index) {
			this.lazyLoading.visibleGroups.add(index);
		},
		
		// ëª¨ë“  ê·¸ë£¹ ê°•ì œ ë¡œë“œ (ê²€ìƒ‰ ì‹œ ìœ ìš©)
		forceLoadAllGroups() {
			for (let i = 0; i < this.searched_data.length; i++) {
				if (this.searched_data[i].length > 0) {
					this.lazyLoading.visibleGroups.add(i);
				}
			}
		},
		
		// í˜„ì¬ ë¡œë“œëœ ê·¸ë£¹ í†µê³„
		getLazyLoadingStats() {
			const totalGroups = this.searched_data.filter(data => data.length > 0).length;
			const loadedGroups = this.lazyLoading.visibleGroups.size;
			
			return {
				total: totalGroups,
				loaded: loadedGroups,
				percentage: totalGroups > 0 ? Math.round((loadedGroups / totalGroups) * 100) : 0
			};
		},
		// ed-ì§€ì—°ë¡œë”© ë©”ì„œë“œ
		changeListVersion(e) {
			this.loadExcelWithLastModified();
		},
		// ê³ ë™ì‹œì„± ìµœì í™”ëœ Vue3 Options API ì½”ë“œ (WebWorker ì œê±°, ë‚ ì§œ ì •ë³´ ë³´ì¥)
		// 1) ê³ ë™ì‹œì„± ì²˜ë¦¬ í•¨ìˆ˜
		async runWithHighConcurrency(tasks, concurrency = 80) {
			const results = [];
			let activeCount = 0;
			let taskIndex = 0;
			let completed = 0;
			const total = tasks.length;

			return new Promise((resolve) => {
				const next = () => {
					if (taskIndex === tasks.length && activeCount === 0) {
						return resolve(results);
					}
					while (activeCount < concurrency && taskIndex < tasks.length) {
						const current = taskIndex++;
						const task = tasks[current];
						activeCount++;
						
						task()
						.then(res => { 
							results[current] = res; 
							completed++;
							
							// ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (10% ë‹¨ìœ„ë¡œ)
							const progress = Math.floor((completed / total) * 100);
							if (progress !== this.processingProgress && progress % 10 === 0) {
								this.processingProgress = progress;
								console.log(`ì§„í–‰ë¥ : ${progress}% (${completed}/${total})`);
							}
						})
						.catch(err => {
							results[current] = null;
							completed++;
						})
						.finally(() => {
							activeCount--;
							next();
						});
					}
				};
				next();
			});
		},

		// 2) ìµœì í™”ëœ HEAD ìš”ì²­
		async fetchLastModifiedOptimized(url) {
			if (!url) return null;
			// return null;
			
			// ìºì‹œ í™•ì¸
			if (this.urlCache.has(url)) {
				return this.urlCache.get(url);
			}

			try {
				const controller = new AbortController();
				setTimeout(() => controller.abort(), 1000); // 1ì´ˆ íƒ€ì„ì•„ì›ƒ

				const res = await fetch(url, { 
					method: 'HEAD',
					signal: controller.signal,
					cache: 'force-cache'
				});
				
				if (!res.ok) {
					this.urlCache.set(url, null);
					return null;
				}
				
				const lm = res.headers.get('Last-Modified');
				const result = lm ? new Date(lm) : null;
				
				// ìºì‹œì— ì €ì¥
				this.urlCache.set(url, result);
				return result;
				
			} catch (error) {
				this.urlCache.set(url, null);
				return null;
			}
		},

		// 3) ë©”ì¸ ì—‘ì…€ ë¡œë”© í•¨ìˆ˜
		async loadExcelWithLastModified() {
			this.loading(true);
			this.processingProgress = 0;
			
			try {

				this.EXCEL_JSON_HEADER = [];
				this.EXCEL_JSON_DATA = [];
				this.ORIGINAL_EXCEL_JSON_HEADER = null;


				await this.read__channels();


				this.ia_tabs = this.selectedChannel.ia_tabs;
				
				const iafile = this.getIaxlsxPath();
				const url = this.domain + iafile;
				const arrayBuffer = await (await fetch(url)).arrayBuffer();

				console.log('ì—‘ì…€ íŒŒì‹± ì‹œì‘...');
				
				// XLSX íŒŒì‹± ìµœì í™”
				const workbook = XLSX.read(arrayBuffer, {
					cellStyles: false,
					cellFormulas: false,
					sheetStubs: false,
					bookSST: false
				});
				
				// ì „ì—­ URL ìˆ˜ì§‘ ë° ì‹œíŠ¸ ë°ì´í„° ì €ì¥
				const globalUrlSet = new Set();
				const allSheetData = [];
				
				for (const sheetName of workbook.SheetNames) {
					const ws = workbook.Sheets[sheetName];
					const rows = XLSX.utils.sheet_to_json(ws, { 
						defval: null,
						raw: false,
						blankrows: false
					});

					allSheetData.push({ sheetName, rows });
					this.EXCEL_JSON_HEADER.push(sheetName);
					
					// URL ìˆ˜ì§‘
					rows.forEach(row => {
						const fileUrl = this.buildFileUrl(row);
						if (fileUrl) globalUrlSet.add(fileUrl);
					});
				}

				// ì›ë³¸ í—¤ë” ë°±ì—…
				if (!this.ORIGINAL_EXCEL_JSON_HEADER) {
					this.ORIGINAL_EXCEL_JSON_HEADER = [...this.EXCEL_JSON_HEADER];
				}

				const uniqueUrls = Array.from(globalUrlSet);
				console.log(`ê³ ë™ì‹œì„±ìœ¼ë¡œ ${uniqueUrls.length}ê°œ URL ì²˜ë¦¬ ì‹œì‘...`);

				// ê³ ë™ì‹œì„±ìœ¼ë¡œ ì²˜ë¦¬
				const urlTasks = uniqueUrls.map(url => () => this.fetchLastModifiedOptimized(url));
				
				const startTime = Date.now();
				const lastModResults = await this.runWithHighConcurrency(urlTasks, 80);
				const endTime = Date.now();
				
				console.log(`HTTP ìš”ì²­ ì™„ë£Œ: ${endTime - startTime}ms`);

				// ê²°ê³¼ ë§¤í•‘
				const globalUrlToResult = new Map();
				uniqueUrls.forEach((url, index) => {
					globalUrlToResult.set(url, lastModResults[index]);
				});

				// ê° ì‹œíŠ¸ ë°ì´í„° êµ¬ì„±
				this.EXCEL_JSON_DATA = [];
				for (const { sheetName, rows } of allSheetData) {
					const rowsWithDate = rows.map(row => ({
						...row,
						lastModified: globalUrlToResult.get(this.buildFileUrl(row))
					}));

					this.EXCEL_JSON_DATA.push(rowsWithDate);
				}

				this.searched_data = JSON.parse(JSON.stringify(this.EXCEL_JSON_DATA));
				this.iaDownloadUrl = url;
				
				console.log('ì „ì²´ ì²˜ë¦¬ ì™„ë£Œ!');
				this.processingProgress = 100;

				// ì§€ì—° ë¡œë”© ì´ˆê¸°í™”
				this.$nextTick(() => {
					this.preloadInitialGroups(3); // ì²« 3ê°œ ê·¸ë£¹ ë¯¸ë¦¬ ë¡œë“œ
					this.initLazyLoading();
				});
				
			} catch (e) {
				console.error('ì—‘ì…€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', e);
			} finally {
				// setTimeout( () => {
					this.loading(false);
				// }, 4000);
			}
		},

		// 4) URL ìƒì„± í—¬í¼
		buildFileUrl(row) {
			const path = row['ê²½ë¡œ'] || '';
			const file = row['íŒŒì¼ëª…'] || '';
			return path && file ? path + file : null;
		},

		// 5) ì—‘ì…€ ê²½ë¡œ ìƒì„±
		getIaxlsxPath() {
			let iafile = this.selectedChannel.doc_base +
						'/iaxlsx/ia_' + this.selectedChannel.code + '.xlsx';

			let custom = this.ia_tabs[this.tabIndex].ia_file;

			// ìŠ¤ë§ˆíŠ¸ ì‹ ê·œë§Œ ì ìš©
			if (this.pageChannel == 'SH_PA' && this.listVersion == 'tobe') {
				custom = this.selectedChannel.doc_base + '/iaxlsx/ia_smart_new.xlsx';
			}

			return custom && custom.trim() !== '' ? custom : null;
		},

		clearUrlCache() {
			if (this.urlCache && typeof this.urlCache.clear === 'function') {
				this.urlCache.clear();
			}
		},
		matchType: function (type, matchStr) {
			var rtn = false;
			
			if (type != undefined && type != null){
				var typeArr = type.split('-');
				
				if (type.length > 0) {
					var matchedTxt = type.find((item) => item == matchStr);
					
					if (matchedTxt != undefined && matchedTxt == matchStr) rtn = true;
				}
			}
			
			return rtn;
		},
		makeLink: function (path, filename) {
			if (path !== null && path != undefined && path != '') {
				path =  path.trim();
				filename = filename && filename.trim();
				
				if (path.charAt(path.length - 1) == '/') path = path.substr(0, path.length-1); 
				
				var pathTmp = path.substr(1);
				var pathArr = pathTmp.split('/');
				
				path = pathArr.filter(item => {
					if (item == this.selectedChannel.doc_base.substr(1)) {
						return false;
					}
					else {
						return true;
					}
				}).join('/');
				
				if (path.charAt(0) != '/') path = '/'+path;
				
				if (filename != undefined && filename != '') {
					if (filename.substr(-5) != '.html') {
						filename = filename + '.html';
					}
				}
				
				return this.selectedChannel.doc_base + path + '/' + filename;
			}
			
			else {
				return '';
			}
		},
		
		// ë‚ ì§œ ì°¨ì´ ê³„ì‚°
		getDaysDifference(date1, date2) {
			const d1 = new Date(date1);
			const d2 = new Date(date2);
			return Math.floor((d1 - d2) / (1000 * 60 * 60 * 24));
		},

		// ë‚ ì§œ í•„í„°ë§ (ì´ˆê¸°í™” í›„ ì‹¤í–‰)
		filterByDate(months) {
			// 1. ë¨¼ì € ì´ˆê¸°í™”
			this.resetToOriginal();
			
			// 2. í•„í„°ë§ ì‹¤í–‰
			this.searched_data = [];
			const today = new Date();
			const cutoffDate = new Date();
			cutoffDate.setMonth(cutoffDate.getMonth() - months);

			this.EXCEL_JSON_DATA.forEach(sheetData => {
				const filteredData = sheetData.filter(row => {
					if (!row.lastModified) return false;
					
					const lastModified = new Date(row.lastModified);
					if (isNaN(lastModified.getTime())) return false;
					
					return lastModified >= cutoffDate;
				});
				this.searched_data.push(filteredData);
			});
			
			console.log(`${months}ê°œì›” ì´ë‚´ ìˆ˜ì •ëœ íŒŒì¼: ${this.getFilteredCount()}ê°œ`);

			// í•„í„°ë§ í›„ ì§€ì—° ë¡œë”© ì¬ì„¤ì •
			this.resetLazyLoading();
		},

		// 7-1) ìµœê·¼ Nì£¼ì¼ ë‚´ ìˆ˜ì •ëœ íŒŒì¼ ì¡°íšŒ
		filterByLastWeek(week = 1) {
			this.resetToOriginal();
			this.searched_data = [];
			const today = new Date();
			const weekAgo = new Date();
			
			const weekNo = week ? week * 7 : 7;
			weekAgo.setDate(weekAgo.getDate() - weekNo); // Nì£¼ì¼ ì „

			this.EXCEL_JSON_DATA.forEach(sheetData => {
				const filteredData = sheetData.filter(row => {
					if (!row.lastModified) return false;
					const lastModified = new Date(row.lastModified);
					if (isNaN(lastModified.getTime())) return false;
					return lastModified >= weekAgo;
				});
				this.searched_data.push(filteredData);
			});
			
			console.log(`ìµœê·¼ ${week}ì£¼ì¼ ë‚´ ìˆ˜ì •ëœ íŒŒì¼: ${this.getFilteredCount()}ê°œ`);

			// í•„í„°ë§ í›„ ì§€ì—° ë¡œë”© ì¬ì„¤ì •
			this.resetLazyLoading();
		},

		// ë‚ ì§œ ìˆœ ì •ë ¬ (ì´ˆê¸°í™” í›„ ì‹¤í–‰)
		sortByDate() {
			// 1. ë¨¼ì € ì´ˆê¸°í™”
			this.resetToOriginal();
			
			// 2. ê° ì‹œíŠ¸ ë‚´ë¶€ ë°ì´í„°ë¥¼ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
			const sortedData = this.EXCEL_JSON_DATA.map(sheetData => {
				return [...sheetData].sort((a, b) => {
					if (!a.lastModified && !b.lastModified) return 0;
					if (!a.lastModified) return 1;
					if (!b.lastModified) return -1;
					
					const dateA = new Date(a.lastModified);
					const dateB = new Date(b.lastModified);
					
					if (isNaN(dateA.getTime()) && isNaN(dateB.getTime())) return 0;
					if (isNaN(dateA.getTime())) return 1;
					if (isNaN(dateB.getTime())) return -1;
					
					return dateB - dateA; // ìµœì‹ ìˆœ
				});
			});

			// 3. ê° ì‹œíŠ¸ë³„ë¡œ ê°€ì¥ ìµœì‹  íŒŒì¼ì˜ ë‚ ì§œ ì°¾ê¸°
			const sheetLatestDates = sortedData.map((sheetData, index) => {
				let latestDate = null;
				
				for (const row of sheetData) {
					if (row.lastModified) {
						const date = new Date(row.lastModified);
						if (!isNaN(date.getTime())) {
							latestDate = date;
							break;
						}
					}
				}
				
				return {
					index: index,
					header: this.ORIGINAL_EXCEL_JSON_HEADER[index],
					data: sheetData,
					latestDate: latestDate
				};
			});

			// 4. ì‹œíŠ¸ë“¤ì„ ê°€ì¥ ìµœì‹  íŒŒì¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
			sheetLatestDates.sort((a, b) => {
				if (!a.latestDate && !b.latestDate) return 0;
				if (!a.latestDate) return 1;
				if (!b.latestDate) return -1;
				
				return b.latestDate - a.latestDate; // ìµœì‹ ìˆœ
			});

			// 5. ì •ë ¬ëœ ìˆœì„œë¡œ í—¤ë”ì™€ ë°ì´í„° ì¬ë°°ì¹˜
			this.EXCEL_JSON_HEADER = sheetLatestDates.map(item => item.header);
			this.searched_data = sheetLatestDates.map(item => item.data);

			console.log('ì¹´í…Œê³ ë¦¬ë³„ ìµœì‹  ìˆ˜ì •ì¼ ìˆœìœ¼ë¡œ ì •ë ¬ ì™„ë£Œ');

			// í•„í„°ë§ í›„ ì§€ì—° ë¡œë”© ì¬ì„¤ì •
			this.resetLazyLoading();
		},

		// ì›ë³¸ ìƒíƒœë¡œ ì´ˆê¸°í™”í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
		resetToOriginal() {
			if (this.ORIGINAL_EXCEL_JSON_HEADER) {
				this.EXCEL_JSON_HEADER = [...this.ORIGINAL_EXCEL_JSON_HEADER];
			}
			this.searched_data = JSON.parse(JSON.stringify(this.EXCEL_JSON_DATA));
		},

		// ì´ˆê¸°í™” (ê¸°ì¡´ í•¨ìˆ˜)
		resetData() {
			this.resetToOriginal();
			console.log('ë°ì´í„° ë° ì¹´í…Œê³ ë¦¬ ìˆœì„œ ì´ˆê¸°í™” ì™„ë£Œ');

			// í•„í„°ë§ í›„ ì§€ì—° ë¡œë”© ì¬ì„¤ì •
			this.resetLazyLoading();
		},

		// ìƒˆë¡œ ì¶”ê°€ëœ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
		getFilteredCount() {
			return this.searched_data.reduce((count, sheetData) => count + sheetData.length, 0);
		},

		getDateStatistics() {
			const stats = {
				total: 0,
				withDate: 0,
				withoutDate: 0,
				lastWeek: 0,
				lastMonth: 0,
				lastYear: 0
			};

			const now = new Date();
			const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
			const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
			const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);

			this.EXCEL_JSON_DATA.forEach(sheetData => {
				sheetData.forEach(row => {
					stats.total++;
					
					if (row.lastModified) {
						const modDate = new Date(row.lastModified);
						if (!isNaN(modDate.getTime())) {
							stats.withDate++;
							if (modDate >= weekAgo) stats.lastWeek++;
							if (modDate >= monthAgo) stats.lastMonth++;
							if (modDate >= yearAgo) stats.lastYear++;
						} else {
							stats.withoutDate++;
						}
					} else {
						stats.withoutDate++;
					}
				});
			});

			return stats;
		},

		// ëª¨ë°”ì¼ html ë¯¸ë¦¬ë³´ê¸° íŒì—… ì—´ê¸°
		openHtml: function (e) {
			var path = $(e.target).attr('href');
			let domain = this.domain;
			let isInbank = false;
			
			if (path.startsWith('/inbank')) {
				isInbank = true;
				// domain ì—ì„œ í¬íŠ¸ë¥¼ 7002 ë¡œ ë³€ê²½
				domain = domain.replace(':7001', ':7002');
				path = path.replace('/inbank', '');
			}

			var pathname = domain+path;
			
			if (e.shiftKey || this.isMobile) {
				window.open(pathname + '?' + Date.now());
				e.preventDefault();
			}
			else {
				if (!isInbank) {
					$('#html-view-area').attr('src', pathname + '?' + Date.now());
					setTimeout(function () {
						$('#html-view-area').show();
					}, 50);
					
					this.htmlShow = true;
					this.resizing = false;
				} else {
					window.open(pathname + '?' + Date.now());
					e.preventDefault();
				}
			}
		},
		// ëª¨ë°”ì¼ html ë¯¸ë¦¬ë³´ê¸° íŒì—… ë”¤ë“œì˜ì—­ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
		closeHtmlFromDim: function (e) {
			if (e.target.getAttribute('class') == 'modal_layer_pop' && !this.resizing) {
				this.htmlShow = false;
			}
		},
		iaPath: function (parent) {
			var path = this.makePath(parent);
			
			return path.reverse().join('/');
		},
		makePath: function (parent, path=[]) {
			this.searchList.forEach(ia => {
				
				if (ia.id != parent) return;
				
				if (ia.id == parent) {
					path.push(ia.text);
					
					this.makePath(ia.parent, path);
				}
			});
			
			return path; //newPath;
		},
		accordion: function (e, index) {
			// this.changeProperties = true;
			// ì•„ì½”ë””ì–¸ í´ë¦­ ì‹œ í•´ë‹¹ ê·¸ë£¹ì„ ê°•ì œ ë¡œë“œ
			this.forceLoadGroup(index);

			var isOpen = e.target.getAttribute('aria-expanded');
		
			if (index !== undefined && this.refsArray[index]) {
				this.refsArray[index].toggle(index);
			}

			// if (isOpen == 'true') {
			// 	e.target.setAttribute('aria-expanded', false);
			// } else {
			// 	e.target.setAttribute('aria-expanded', true);
			// }

			// clearTimeout(this.changePropertiesTimer);
			// this.changePropertiesTimer = setTimeout(() => this.changeProperties = false, 150);
		},
		searchHandler: function () {
			var app = this;
			
			if (this.searchText.replace(/\s/g, '') == '') {
				this.searched_data = this.EXCEL_JSON_DATA;
			}
			else {
				this.searched_data = [];
				
				this.EXCEL_JSON_DATA.forEach(item => {
					var tmpArr = item.filter(filteredItem => {
						return (
							filteredItem['1depth'] && filteredItem['1depth'].indexOf(this.searchText) != -1 || 
							filteredItem['2depth'] && filteredItem['2depth'].indexOf(this.searchText) != -1 || 
							filteredItem['3depth'] && filteredItem['3depth'].indexOf(this.searchText) != -1 || 
							filteredItem['4depth'] && filteredItem['4depth'].indexOf(this.searchText) != -1 || 
							filteredItem['í™”ë©´ëª…'] && filteredItem['í™”ë©´ëª…'].indexOf(this.searchText) != -1 || 
							filteredItem['íŒŒì¼ëª…'] && filteredItem['íŒŒì¼ëª…'].indexOf(this.searchText) != -1);
					});
					
					this.searched_data.push(tmpArr);
				}); //end. forEach
			}

			// ê²€ìƒ‰ í›„ ì§€ì—° ë¡œë”© ì¬ì„¤ì •
			this.resetLazyLoading();
			
			// ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆëŠ” ê·¸ë£¹ë“¤ì„ ì¦‰ì‹œ ë¡œë“œ (ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°”ë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´)
			if (this.searchText.trim() !== '') {
				setTimeout(() => {
					this.forceLoadAllGroups();
				}, 200);
			}
		},
		// íƒ‘ìœ¼ë¡œ ì´ë™
		goTop: function () {
			window.scrollTo({
			  top: 100,
			  behavior: "smooth",
			});
		},
		siteMapChange: async function (tabIndex) {
			this.tabIndex = tabIndex;
			
			try {
				var iafile = this.selectedChannel.doc_base + '/iaxlsx/ia_'+this.selectedChannel.code+'.xlsx';
				
				if (this.ia_tabs[tabIndex].ia_file != '') {
					iafile = this.ia_tabs[tabIndex].ia_file;
				}
				
				const url = this.domain+iafile;
				const workbook = XLSX.read(await (await fetch(url)).arrayBuffer());
				
				this.EXCEL_JSON_HEADER = [];
				this.EXCEL_JSON_DATA = [];
			  	//ì—‘ì…€íŒŒì¼ì˜ ì‹œíŠ¸ ì •ë³´ë¥¼ ì½ì–´ì„œ JSON í˜•íƒœë¡œ ë³€í™˜í•œë‹¤.
				workbook.SheetNames.forEach((item, index, array) => {
		   	  		this.EXCEL_JSON_HEADER.push(workbook.SheetNames[index]);
				 	this.EXCEL_JSON_DATA.push(XLSX.utils.sheet_to_json(workbook.Sheets[item]));
			  	});//end. forEach
				
			  	this.searched_data = this.EXCEL_JSON_DATA;
			  	this.iaDownloadUrl = url;
			}
			catch(error) {
				console.log(error)
			}
		}, //end siteMapChange
		// html-list-componet ì˜ ref ì €ì¥ ë©”ì„œë“œ
		setRefs(el, index) {
			if (el) {
				this.refsArray[index] = el;
			}
		},
		// Intersection Observer ì´ˆê¸°í™” ë° .data-box ê´€ì°° ì‹œì‘
		initDataBoxObserver() {
			// Observer ì˜µì…˜ ì„¤ì •
			const options = {
				root: null,           // ë·°í¬íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ
				rootMargin: '0px',    // ë§ˆì§„ ì—†ìŒ
				threshold: 0.1        // 10% ë³´ì´ë©´ íŠ¸ë¦¬ê±°
			};

			// Observer ì½œë°± í•¨ìˆ˜
			const callback = (entries) => {
				console.log(entries)
				entries.forEach(entry => {
					if (entry.target.classList.contains('menu_wrap')) {
						// data-boxê°€ ë³´ì´ë©´ isVisible = true, ì•ˆë³´ì´ë©´ false
						setTimeout(() => {
							this.compoVisible = entry.isIntersecting;
						}, 150)
					}
				});
			};

			// Observer ìƒì„±
			this.observer = new IntersectionObserver(callback, options);
			
			// .data-box ìš”ì†Œë“¤ ê´€ì°° ì‹œì‘
			this.observeDataBoxes();
		},
		// .data-box ìš”ì†Œë“¤ì„ ì°¾ì•„ì„œ Observerì— ë“±ë¡
		observeDataBoxes() {
			console.log('observer')
			this.$nextTick(() => {
				const dataBoxes = document.querySelectorAll('.menu_wrap');
				dataBoxes.forEach(box => {
					console.log(box)
					this.observer.observe(box);
				});
			});
		},
		 // Observer ì •ë¦¬
		destroyObserver() {
			if (this.observer) {
				this.observer.disconnect();
				this.observer = null;
			}
		},
		// ì „ì²´ ë³´ì´ëŠ” ê·¸ë£¹ ìˆ˜ ê³„ì‚°
		getTotalVisibleGroups() {
			return this.searched_data.filter(data => data.length > 0).length;
		},
		
		// ë¸Œë¼ìš°ì € ê²€ìƒ‰ìš© ëª¨ë“  ê·¸ë£¹ ë¡œë“œ
		loadAllForBrowserSearch() {
			console.log('ë¸Œë¼ìš°ì € ê²€ìƒ‰ì„ ìœ„í•´ ëª¨ë“  ê·¸ë£¹ ë¡œë“œ ì‹œì‘...');
			
			this.forceLoadAllGroups();
			this.allGroupsForceLoaded = true;
			
			this.$nextTick(() => {
				setTimeout(() => {
					const stats = this.getLazyLoadingStats();
					console.log(`ëª¨ë“  ê·¸ë£¹ ë¡œë“œ ì™„ë£Œ: ${stats.loaded}/${stats.total}`);
					
					// ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´
					alert('ëª¨ë“  ê·¸ë£¹ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ Ctrl+Fë¡œ ì „ì²´ ê²€ìƒ‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
				}, 1000);
			});
		},
		
		// Ctrl+F ìë™ ê°ì§€ ë° ì²˜ë¦¬
		handleKeyboardSearch(event) {
			if ((event.ctrlKey || event.metaKey) && event.key === 'f') {
				if (!this.isAllGroupsLoaded) {
					console.log('Ctrl+F ê°ì§€ - ìë™ìœ¼ë¡œ ëª¨ë“  ê·¸ë£¹ ë¡œë“œ');
					
					// ì‚¬ìš©ìì—ê²Œ ì ì‹œ ê¸°ë‹¤ë¦¬ë¼ê³  ì•Œë¦¼
					const notification = this.showSearchLoadingNotification();
					
					this.forceLoadAllGroups();
					this.allGroupsForceLoaded = true;
					
					this.$nextTick(() => {
						setTimeout(() => {
							this.hideSearchLoadingNotification(notification);
							console.log('ë¡œë”© ì™„ë£Œ - Ctrl+F ê²€ìƒ‰ ê°€ëŠ¥');
						}, 800);
					});
				}
			}
		},
		
		// ê²€ìƒ‰ ë¡œë”© ì•Œë¦¼ í‘œì‹œ
		showSearchLoadingNotification() {
			const notification = document.createElement('div');
			notification.className = 'search-loading-notification';
			notification.innerHTML = `
				<div class="notification-content">
					<div class="loading-spinner"></div>
					<span>ì „ì²´ ê²€ìƒ‰ì„ ìœ„í•´ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...</span>
				</div>
			`;
			
			// ìŠ¤íƒ€ì¼ ì ìš©
			Object.assign(notification.style, {
				position: 'fixed',
				top: '20px',
				right: '20px',
				background: '#007bff',
				color: 'white',
				padding: '12px 20px',
				borderRadius: '6px',
				zIndex: '10000',
				boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
				fontSize: '14px'
			});
			
			document.body.appendChild(notification);
			return notification;
		},
		
		// ê²€ìƒ‰ ë¡œë”© ì•Œë¦¼ ìˆ¨ê¸°ê¸°
		hideSearchLoadingNotification(notification) {
			if (notification && notification.parentNode) {
				notification.style.opacity = '0';
				notification.style.transition = 'opacity 0.3s';
				setTimeout(() => {
					notification.parentNode.removeChild(notification);
				}, 300);
			}
		},
		
		// ë°ì´í„° ì¬ì„¤ì • ì‹œ ê°•ì œ ë¡œë“œ ìƒíƒœë„ ë¦¬ì…‹
		resetLazyLoading() {
			this.destroyLazyLoading();
			this.allGroupsForceLoaded = false;
			
			this.$nextTick(() => {
				setTimeout(() => {
					this.initLazyLoading();
				}, 100);
			});
		}
	},
	// ì»´í¬ë„ŒíŠ¸ í•´ì œ ì‹œ ìºì‹œ ì •ë¦¬
	beforeUnmount() {
		// ì§ì ‘ ì²´í¬í•˜ì—¬ ì—ëŸ¬ ë°©ì§€
		this.clearUrlCache();
		// ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ Observer ì •ë¦¬
		this.destroyObserver();

		// ì§€ì—° ë¡œë”© ì •ë¦¬ ì¶”ê°€
		this.destroyLazyLoading();
		
		// í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
		document.removeEventListener('keydown', this.handleKeyboardSearch);
		console.log('ì§€ì—° ë¡œë”© ì •ë¦¬ ì™„ë£Œ');
	}
};

// .component('header-component', HeaderComponent)
// .use(pinia)
// .mount('#v-app');

</script>
<style scoped>
.input_section {
	border-bottom: 0;
}
.input_area.search_case button {
	top: 50%;
    transform: translateY(-50%);
	right: 20px;
}
.input_area.search_case input {
	width: 93%;
    border: 2px solid #e55318;
    height: 50px;
}
.input_area.search_case label {
	line-height: 50px;
}

/* dl, dt, dd ìŠ¤íƒ€ì¼ */
.horizontal-dl {
	display: flex;
	align-items: center;
	gap: 12px;
}

.horizontal-dl dt {
	margin: 0;
}

.button-group {
	display: flex;
	gap: 6px;
}

.round-button {
	background-color: #f0f0f0;
	border: 1px solid #d0d0d0;
	border-radius: 6px;
	padding: 6px 12px;
	font-size: 14px;
	cursor: pointer;
	transition: all 0.2s ease;
}

.round-button:hover {
	background-color: #e0e0e0;
}
.progress-container {
	position: relative;
	z-index: 10000;
}
.progress-bar {
  width: 100%;
  height: 4px;
  background: #f0f0f0;
  border-radius: 2px;
  position: relative;
}
.progress-text {
	text-align: center;
	color: #fff;
	font-weight: bold;
}
.progress-fill {
  height: 100%;
  background: #4CAF50;
  border-radius: 2px;
  transition: width 0.3s ease;
}
.input_wrap {
	max-width: 700px;
}
.list-version {
    /* border-bottom: 4px solid #535353; */
    padding-bottom: 15px;
	position: relative;
    width: 50%;
}
.list-version::after {
    content: 'â–¼';
    position: absolute;
    left: 220px;
    font-size: 29px;
	pointer-events: none;
	touch-action: none;
	z-index: 2;
}
.list-version select {
	font-size: 28px;
    color: #333;
    font-family: 'S-CoreDream-5Medium';
	border: 0;
	width: 250px;
}

/* ì§€ì—°ë¡œë”© ìŠ¤íƒ€ì¼ */
/* ì§€ì—° ë¡œë”© í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼ */
.lazy-placeholder {
	min-height: 120px;
	background: #f8f9fa;
	border: 1px dashed #dee2e6;
	border-radius: 4px;
	margin: 10px 0;
	display: flex;
	align-items: center;
	justify-content: center;
	transition: all 0.3s ease;
}

.lazy-placeholder:hover {
	background: #e9ecef;
	border-color: #adb5bd;
}

.placeholder-content {
	text-align: center;
	color: #6c757d;
}

.placeholder-text {
	font-size: 14px;
	margin-bottom: 10px;
}

/* ë¡œë”© ì ë“¤ ì• ë‹ˆë©”ì´ì…˜ */
.loader-dots {
	display: flex;
	gap: 4px;
	justify-content: center;
}

.loader-dots span {
	width: 8px;
	height: 8px;
	background: #007bff;
	border-radius: 50%;
	display: inline-block;
	animation: dotPulse 1.4s ease-in-out infinite both;
}

.loader-dots span:nth-child(1) { animation-delay: -0.32s; }
.loader-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes dotPulse {
	0%, 80%, 100% { 
		transform: scale(0.8);
		opacity: 0.5;
	}
	40% { 
		transform: scale(1);
		opacity: 1;
	}
}

/* ê·¸ë£¹ ì•„ì´í…œ ìˆ˜ í‘œì‹œ */
.group-item-count {
	font-size: 12px;
	color: #6c757d;
	font-weight: normal;
	margin-left: 8px;
}

/* ë¡œë“œëœ ê·¸ë£¹ í˜ì´ë“œì¸ íš¨ê³¼ */
.menu_wrap {
	transition: opacity 0.3s ease;
}

/* ëª¨ë°”ì¼ì—ì„œ í”Œë ˆì´ìŠ¤í™€ë” ë†’ì´ ì¡°ì • */
@media (max-width: 768px) {
	.lazy-placeholder {
		min-height: 80px;
	}
	
	.placeholder-text {
		font-size: 12px;
	}
}
</style>